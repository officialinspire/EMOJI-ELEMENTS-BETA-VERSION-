<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a0f20">
    <title>EMOJI ELEMENTS</title>
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Inter:wght@400;500;700&family=MedievalSharp&family=Uncial+Antiqua&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Click to Start Overlay -->
    <div id="clickToStart" class="click-to-start-overlay">
        <div class="click-to-start-content">
            <div class="click-to-start-title">âš”ï¸ EMOJI ELEMENTS âš”ï¸</div>
            <div class="click-to-start-tagline">Arcane duels. Elemental strategy.</div>
            <div class="click-to-start-text">ğŸ® CLICK TO START ğŸ®</div>
            <div class="click-to-start-hint">(with sound)</div>
        </div>
    </div>

    <!-- Intro Video Container -->
    <div id="introContainer" class="intro-container" style="display: none;">
        <video id="introVideo" class="intro-video" playsinline webkit-playsinline preload="auto">
            <source src="inspiresoftwareintro.mp4" type="video/mp4">
        </video>
        <div class="intro-credit">
            <span>Intro animation by Inspire Software</span>
            <a href="https://www.inspireclothing.art" target="_blank" rel="noopener noreferrer">www.inspireclothing.art</a>
        </div>
        <div class="intro-skip-hint">Tap anywhere to skip</div>
    </div>

    <canvas id="particles"></canvas>

    <!-- Game Log -->
    <div id="gameLog" class="game-log"></div>

    <!-- Victory/Lose Overlays -->
    <div id="victoryOverlay" class="victory-overlay">
        <div class="victory-text">ğŸ† VICTORY! ğŸ†</div>
        <button class="menu-btn overlay-btn" onclick="playAgain()">ğŸ”„ PLAY AGAIN</button>
        <button class="menu-btn overlay-btn" onclick="returnToMainMenu()" style="background: linear-gradient(135deg, #4169e1 0%, #6495ed 100%); color: #fff; border-color: #1a3a7a;">ğŸ  MAIN MENU</button>
    </div>
    <div id="loseOverlay" class="lose-overlay">
        <div class="lose-text">ğŸ’€ DEFEAT! ğŸ’€</div>
        <button class="menu-btn overlay-btn" onclick="playAgain()">ğŸ”„ TRY AGAIN</button>
        <button class="menu-btn overlay-btn" onclick="returnToMainMenu()" style="background: linear-gradient(135deg, #4169e1 0%, #6495ed 100%); color: #fff; border-color: #1a3a7a;">ğŸ  MAIN MENU</button>
    </div>

    <div id="packOpeningOverlay" class="pack-opening-overlay" data-lock-scroll="true">
        <div class="pack-opening-panel">
            <div class="pack-opening-header">
                <div class="pack-opening-title">ğŸ Victory Pack</div>
                <button class="pack-close-btn" id="packCloseBtn">âœ•</button>
            </div>

            <div id="packSealedStage" class="pack-stage pack-stage-active">
                <div class="pack-instruction" id="packInstruction">Slide to rip open</div>
                <div class="pack-sealed-shell" id="packTearSurface">
                    <div class="pack-tear-line" id="packTearLine"></div>
                    <div class="pack-sealed-emoji">ğŸ“¦</div>
                </div>
                <div class="pack-progress-track">
                    <div id="packProgressFill" class="pack-progress-fill"></div>
                </div>
            </div>

            <div id="packRevealStage" class="pack-stage">
                <div id="packCardViewport" class="pack-card-viewport">
                    <div id="packCardEmoji" class="pack-card-emoji">âœ¨</div>
                    <div id="packCardName" class="pack-card-name"></div>
                    <div id="packCardType" class="pack-card-type"></div>
                </div>
                <div id="packCardCounter" class="pack-card-counter"></div>
                <div class="pack-nav-buttons">
                    <button class="menu-btn" id="packPrevBtn">â¬…ï¸ PREV</button>
                    <button class="menu-btn" id="packNextBtn">NEXT â¡ï¸</button>
                </div>
            </div>

            <div id="packQaDebug" class="pack-qa-debug" aria-live="polite"></div>
        </div>
    </div>

    <!-- Card Detail Popup -->
    <div id="cardDetailPopup" class="card-detail-popup">
        <div class="close-detail" onclick="hideCardDetail()">âœ•</div>
        <div class="card-detail-emoji" id="detailEmoji"></div>
        <div class="card-detail-name" id="detailName"></div>
        <div id="detailContent"></div>
    </div>

    <!-- Mana Choice Modal (for dual lands) -->
    <div id="manaChoiceModal" class="mana-choice-modal">
        <div class="mana-choice-content">
            <div class="mana-choice-title">Choose Mana Color</div>
            <div class="mana-choice-options" id="manaChoiceOptions"></div>
        </div>
    </div>

    <!-- Mulligan Confirm Modal -->
    <div id="mulliganConfirmModal" class="game-confirm-modal">
        <div class="game-confirm-content">
            <div class="game-confirm-title">ğŸ”„ MULLIGAN?</div>
            <div class="game-confirm-text">Put all cards back and draw 6 new cards?</div>
            <div class="game-confirm-buttons">
                <button class="menu-btn" id="mulliganYesBtn">âœ… YES</button>
                <button class="menu-btn" id="mulliganNoBtn">âŒ NO</button>
            </div>
        </div>
    </div>

    <!-- Generic Confirm Modal (for quit, reset, etc.) -->
    <div id="gameConfirmModal" class="game-confirm-modal">
        <div class="game-confirm-content">
            <div class="game-confirm-title" id="gameConfirmTitle"></div>
            <div class="game-confirm-text" id="gameConfirmText"></div>
            <div class="game-confirm-buttons">
                <button class="menu-btn" id="gameConfirmYesBtn">âœ… YES</button>
                <button class="menu-btn" id="gameConfirmNoBtn">âŒ NO</button>
            </div>
        </div>
    </div>

    <!-- Pause Modal -->
    <div id="pauseModal" class="pause-modal">
        <div class="pause-content">
            <div class="pause-title">â¸ï¸ GAME PAUSED</div>
            <div class="pause-buttons">
                <button class="menu-btn" onclick="resumeGame(event)">â–¶ï¸ RESUME GAME</button>
                <button class="menu-btn" onclick="confirmQuit()">ğŸ  MAIN MENU</button>
            </div>
        </div>
    </div>

    <!-- Graveyard Modal -->
    <div id="graveyardModal" class="graveyard-modal">
        <div class="graveyard-content">
            <div class="graveyard-header">
                <div class="graveyard-title">âš°ï¸ GRAVEYARD</div>
                <button class="graveyard-close" onclick="hideGraveyard()">âœ•</button>
            </div>
            <div class="graveyard-tabs">
                <button class="graveyard-tab active" id="playerGraveyardTab" onclick="renderGraveyard('player')">ğŸ§™ YOUR CARDS</button>
                <button class="graveyard-tab" id="enemyGraveyardTab" onclick="renderGraveyard('enemy')">ğŸ¤– ENEMY CARDS</button>
            </div>
            <div class="graveyard-list" id="graveyardList"></div>
        </div>
    </div>

    <div id="startModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-title">âš”ï¸ EMOJI ELEMENTS âš”ï¸</div>
            <div class="modal-intro">Build a single-color or two-color deck and conquer the arena.</div>
            
            <div class="menu-buttons" id="mainMenu">
                <button class="menu-btn" onclick="showElementSelection()">ğŸ® NEW GAME</button>
                <button class="menu-btn" onclick="showDeckBuilder()">ğŸ› ï¸ DECK BUILDER</button>
                <button class="menu-btn" onclick="showHowToPlay()">ğŸ“œ HOW TO PLAY</button>
                <button class="menu-btn" onclick="showStats()">ğŸ“Š GAME STATS</button>
            </div>

            <div id="elementSelectionScreen" style="display: none;">
                <div class="modal-subtitle">Choose your deck type:</div>
                <div class="deck-mode-selector">
                    <button type="button" class="deck-mode-btn" data-deck-mode="single" onclick="setDeckMode('single')">Single Color</button>
                    <button type="button" class="deck-mode-btn selected" data-deck-mode="dual" onclick="setDeckMode('dual')">Two Colors</button>
                </div>

                <div class="modal-subtitle">Select elements for your deck:</div>
                
                <div class="modal-subtitle" style="margin-top: 20px;">AI Difficulty:</div>
                <div class="difficulty-selector">
                    <button type="button" class="difficulty-btn selected" data-difficulty="easy" onclick="selectDifficulty('easy')">Easy</button>
                    <button type="button" class="difficulty-btn" data-difficulty="medium" onclick="selectDifficulty('medium')">Medium</button>
                    <button type="button" class="difficulty-btn" data-difficulty="hard" onclick="selectDifficulty('hard')">Hard</button>
                </div>

                <div class="element-selector">
                    <button type="button" class="element-btn" data-element="fire" onclick="selectElement('fire')">ğŸ”¥</button>
                    <button type="button" class="element-btn" data-element="water" onclick="selectElement('water')">ğŸ’§</button>
                    <button type="button" class="element-btn" data-element="earth" onclick="selectElement('earth')">ğŸŒ</button>
                    <button type="button" class="element-btn" data-element="swamp" onclick="selectElement('swamp')">ğŸ’€</button>
                    <button type="button" class="element-btn" data-element="light" onclick="selectElement('light')">â˜€ï¸</button>
                </div>
                <button class="btn" id="startBtn" onclick="startGame()" disabled>âš”ï¸ START BATTLE âš”ï¸</button>
                <button class="menu-btn" onclick="backToMenu()" style="margin-top: 15px;">â† BACK</button>
            </div>

            <div id="howToPlayScreen" style="display: none;">
                <div class="how-to-play">
                    <div class="howto-page" data-page="1">
                        <h3>ğŸ¯ Objective</h3>
                        <p>Reduce your opponent's life from 20 to 0 using creatures, spells, and strategy!</p>

                        <h3>ğŸƒ Cards & Mana</h3>
                        <ul>
                            <li><strong>Lands</strong> - Play one per turn to generate mana</li>
                            <li><strong>Creatures</strong> - Cost mana to play, can attack & block</li>
                            <li><strong>Spells</strong> - Instant effects (damage, heal, etc.)</li>
                            <li><strong>Artifacts</strong> - Permanent bonuses on the battlefield</li>
                        </ul>

                        <h3>âš”ï¸ Combat</h3>
                        <ul>
                            <li>Tap lands to generate mana (click on them)</li>
                            <li>Play cards from your hand using mana</li>
                            <li>Click "ATTACK" to select attackers</li>
                            <li>AI will declare blockers automatically</li>
                            <li>Creatures deal damage = their power</li>
                        </ul>

                        <h3>âœ¨ Abilities</h3>
                        <ul>
                            <li><strong>Flying</strong> - Can only be blocked by flying/reach</li>
                            <li><strong>Trample</strong> - Excess damage goes through (screen shake!)</li>
                            <li><strong>Lifelink</strong> - Damage dealt heals you (sparkles!)</li>
                            <li><strong>Haste</strong> - Can attack immediately</li>
                            <li><strong>Vigilance</strong> - Doesn't tap to attack</li>
                            <li><strong>Defender</strong> - Cannot attack</li>
                        </ul>

                        <h3>ğŸ“± Controls</h3>
                        <p>Click cards to play them, tap lands for mana, select attackers in combat phase! Right-click or long-press to see card details.</p>
                    </div>

                    <div class="howto-page" data-page="2" style="display:none;">
                        <h3>ğŸ§© Collecting Cards &amp; Building Decks</h3>
                        <ul>
                            <li>Winning matches awards booster packs to keep your progress growing.</li>
                            <li>Opening packs adds cards directly to your collection.</li>
                            <li>The Deck Builder can only use cards you currently own.</li>
                            <li>Standard deck keys are stable: picking FIRE or FIRE/WATER always loads your saved version for that key.</li>
                            <li>Packs include rarity levels and themed pools like fantasy, sci-fi, tech, alien, robot, and lands.</li>
                            <li>Use Collection to review everything you own and track what you still want to pull.</li>
                        </ul>
                    </div>
                </div>

                <div class="howto-page-nav">
                    <button class="menu-btn howto-nav-btn" type="button" onclick="setHowToPlayPage(1)">â† PAGE 1</button>
                    <span class="howto-page-indicator" id="howToPlayPageIndicator">Page 1/2</span>
                    <button class="menu-btn howto-nav-btn" type="button" onclick="setHowToPlayPage(2)">PAGE 2 â†’</button>
                </div>

                <button class="menu-btn" onclick="backToMenu()" style="margin-top: 20px;">â† BACK TO MENU</button>
            </div>

            <div id="statsScreen" style="display: none;">
                <div class="modal-subtitle">Your Battle Record</div>
                <div class="stats-display">
                    <div class="stat-row">
                        <span class="stat-label">ğŸ† Games Won:</span>
                        <span id="gamesWon">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ğŸ’€ Games Lost:</span>
                        <span id="gamesLost">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">âš”ï¸ Total Battles:</span>
                        <span id="totalGames">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ğŸ“ˆ Win Rate:</span>
                        <span id="winRate">0%</span>
                    </div>
                </div>
                <button class="menu-btn" onclick="resetStats()" style="background: linear-gradient(135deg, #dc143c 0%, #8b0000 100%); color: #fff;">ğŸ”„ RESET STATS</button>
                <button class="menu-btn" onclick="resetMetaProgress()" style="background: linear-gradient(135deg, #b71c1c 0%, #4a0404 100%); color: #fff; margin-top: 10px;">ğŸ§¹ RESET PROGRESS</button>
                <button class="menu-btn" onclick="backToMenu()" style="margin-top: 15px;">â† BACK TO MENU</button>
            </div>

            <div id="deckBuilderScreen" style="display: none;">
                <div class="modal-subtitle">Deck Builder</div>
                <div class="deck-builder-controls">
                    <label for="deckBuilderDeckKey">Deck:</label>
                    <select id="deckBuilderDeckKey"></select>
                </div>
                <div class="deck-builder-columns">
                    <div class="deck-builder-column">
                        <div class="deck-builder-column-title">Eligible Owned Cards</div>
                        <div class="deck-builder-list" id="deckBuilderPool"></div>
                    </div>
                    <div class="deck-builder-column">
                        <div class="deck-builder-column-title">Deck List</div>
                        <div class="deck-builder-list" id="deckBuilderDeck"></div>
                    </div>
                </div>
                <div class="deck-builder-footer">
                    <div id="deckBuilderStatus"></div>
                    <div class="deck-builder-footer-buttons">
                        <button class="menu-btn" onclick="resetDeckBuilderDeck()">â†º RESET TO STARTER</button>
                        <button class="menu-btn" onclick="openDeckBuilderGuide()">ğŸ“˜ DECK BUILDER GUIDE</button>
                        <button class="menu-btn" onclick="saveDeckBuilderDeck()">ğŸ’¾ SAVE DECK</button>
                    </div>
                </div>
                <button class="menu-btn" onclick="backToMenu()" style="margin-top: 12px;">â† BACK TO MENU</button>
            </div>

            <div id="deckBuilderGuideOverlay" class="guide-overlay" style="display:none;">
                <div class="guide-panel">
                    <button class="guide-close-btn" type="button" onclick="closeDeckBuilderGuide()" aria-label="Close Deck Builder Guide">âœ•</button>
                    <h3>ğŸ“˜ Deck Builder Guide</h3>
                    <ul>
                        <li>You can only add cards you <strong>OWN</strong>, earned from booster packs.</li>
                        <li>Copy limits apply: normal cards have a max duplicate limit, and legendary cards have a stricter cap.</li>
                        <li>Color identity matters: mono decks use one element, while two-color decks can only use cards legal for both selected elements.</li>
                        <li>Deck size must match the exact requirement; this keeps draws fair and consistent and is required before saving.</li>
                        <li>Standard decks auto-load by selection: choosing FIRE or FIRE/WATER in battle setup uses that saved deck every match.</li>
                        <li>Winning matches earns themed booster packs, expanding your collection and unlocking more deck-building options.</li>
                    </ul>
                </div>
            </div>

            <div class="modal-footer-credit">
                <a href="https://www.inspireclothing.art" target="_blank" rel="noopener noreferrer">www.inspireclothing.art</a>
            </div>
        </div>
    </div>

    <div class="game-container" id="gameContainer" style="display: none;">
        <div class="header">
            <button class="menu-icon-btn" onclick="pauseGame()">â˜°</button>
            <div class="title">âš”ï¸ EMOJI ELEMENTS âš”ï¸</div>
            <div class="header-right">
                <button class="menu-icon-btn mute-btn" id="muteBtn" onclick="toggleMute()" title="Toggle sound">ğŸ”Š</button>
                <div class="phase-indicator" id="phaseIndicator">MAIN PHASE</div>
            </div>
        </div>

        <div class="battlefield">
            <!-- Enemy Area -->
            <div class="player-area enemy-area">
                <div class="player-info">
                    <div class="life-counter">
                        â¤ï¸ <span id="enemyLife">20</span>
                    </div>
                    <div class="deck-counter">
                        ğŸ´ <span id="enemyDeckCount">60</span>
                    </div>
                    <div class="mana-pool" id="enemyMana"></div>
                </div>
                <div class="cards-row" id="enemyBoard"></div>
            </div>

            <!-- Player Area -->
            <div class="player-area">
                <div class="cards-row" id="playerBoard"></div>
                <div class="player-info">
                    <div class="life-counter">
                        â¤ï¸ <span id="playerLife">20</span>
                    </div>
                    <div class="deck-counter">
                        ğŸ´ <span id="playerDeckCount">60</span>
                    </div>
                    <div class="mana-pool" id="playerMana"></div>
                </div>
            </div>
        </div>

        <div class="hand-area" id="playerHand"></div>

        <div class="controls">
            <button class="btn" id="mulliganBtn" onclick="mulligan()" data-shortcut="[M]"><span class="btn-text">ğŸ”„ MULLIGAN</span></button>
            <button class="btn" id="graveyardBtn" onclick="showGraveyard()"><span class="btn-text">âš°ï¸ GRAVEYARD</span></button>
            <button class="btn btn-attack" id="attackBtn" onclick="enterAttackPhase()" data-shortcut="[A]"><span class="btn-text">âš”ï¸ ATTACK</span></button>
            <button class="btn" id="endTurnBtn" onclick="endTurn()" data-shortcut="[Space]"><span class="btn-text">END TURN</span></button>
        </div>
    </div>

    <div id="cardHoverTooltip" class="card-hover-tooltip"></div>

    <script src="index.js"></script>
</body>
</html>
